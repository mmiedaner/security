<head>
    <title>Post Message Attack </title>
</head>
<body>
    <div id="haed_container" style="width: 100%; height: 50px; margin-bottom: 5px;">
        <span> Welcome to PostMessage Test Page </span>
    </div>
    <div id="config_container" style="width: 100%; height: 200px; margin-bottom: 5px;">
        <div id="left column" style="float:left; width: 50%;">
            <div id="label" style="float:left; margin-right: 5px;">
                <span> Target Url</span>
            </div>
            <div>
                <input type="text" id="targetURL"/>
            </div>
            <div id="label" style="float:left; margin-right: 5px;">
                <span> Message </span>
            </div>
            <div>
                <input type="text" id="message"/>
            </div>

            <div id="label" style="float:left; margin-right: 5px;">
                <span> Domain </span>
            </div>
            <div>
                <input type="text" id="domain"/>
            </div>
        </div>
        <div id="right_container" style="float:left; width: 50%;">
            <div id="button_bar">
                <input type="button" value="load frame" onClick="loadFrame()"/> &nbsp; 
                <input type="button" value="send message" onclick="sendMessageToFrame()"/> &nbsp; 
                <input type="button" value="register dummy event handler" onClick="registerEventHandler()"/> &nbsp;
            </div>
        </div>
    </div>

    <div id="console" style="width: 100%; height: 100px; border: solid black 1px; background-color: lightgrey; margin-bottom: 5px;">

    </div>

    <script>
        function loadFrame(){
            var targetUrl = document.getElementById('targetURL').value;
            document.getElementById('victimFrame').src=targetUrl;
        }

        function analyseFrame(){
            //TODOOA
        }


        function sendMessageToFrame(){
            var url = document.getElementById('targetURL').value.toString();
            var message = document.getElementById('message').value;
            var logMessage = document.getElementById('console').innerHTML.toString();
            logMessage = logMessage + "\n" + "Sending: " + message + " to: " + url;
            document.getElementById('console').innerHTML = logMessage;
            top.postMessage(message, url);
        }

        function registerEventHandler(){
            var frame = document.createElement('iframe');
            var head = document.createElement('head');
            var body = document.createElement('body');
            var script = document.createElement('script');
            script.innerHTML='function msgReceiver(event){ alert(event.data); }; window.addEventListener(\'message\', msgReceiver, false);';
            body.appendChild(script);
            frame.appendChild(head);
            frame.appendChild(body);
            document.getElementById('victimFrame')=frame;
        }
 
    </script>

    <iframe id="victimFrame" style="width: 1200px; height: 1200px;">
        <script>
            function msgReceiver(event){
                alert(event.data);
            };
            window.addEventListener("message", msgReceiver, false);
        </script>
    </iframe>
</body>
</html>
